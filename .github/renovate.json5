{
  "$schema": "https://docs.renovatebot.com/renovate-schema.json",
  "extends": [
    "config:recommended",
    "docker:enableMajor",
    ":dependencyDashboard",
    ":disableRateLimiting",
    ":timezone(America/New_York)",
    ":semanticCommits"
  ],
  "dependencyDashboardTitle": "Renovate Dashboard ðŸ¤–",
  "suppressNotifications": [
    "prEditedNotification",
    "prIgnoreNotification"
  ],
  "regexManagers": [
    {
      "fileMatch": ["(^|/)/Dockerfile$"],
      "matchStrings": [
        "ARG\\s+(\\w+)_VERSION=(?<currentValue>.*?)\\n"
      ],
      "datasourceTemplate": "docker",
      "depNameTemplate": "{{argName}}",
      "versioningTemplate": "docker"
    }
  ],
  "packageRules": [
    {
      "addLabels": [
        "renovate/container",
        "type/major"
      ],
      "additionalBranchPrefix": "{{parentDir}}-",
      "commitMessageExtra": " ( {{currentVersion}} â†’ {{newVersion}} )",
      "commitMessagePrefix": "feat({{parentDir}})!: ",
      "commitMessageTopic": "{{depName}}",
      "labels": [
        "app/{{parentDir}}"
      ],
      "matchDatasources": [
        "docker",
        "github-release-attachments"
      ],
      "matchFileNames": [
        "apps/**/Dockerfile"
      ],
      "matchUpdateTypes": [
        "major"
      ]
    },
    {
      "addLabels": [
        "renovate/container",
        "type/minor"
      ],
      "additionalBranchPrefix": "{{parentDir}}-",
      "commitMessageExtra": "( {{currentVersion}} â†’ {{newVersion}} )",
      "commitMessageTopic": "{{depName}}",
      "labels": [
        "app/{{parentDir}}"
      ],
      "matchDatasources": [
        "docker",
        "github-release-attachments"
      ],
      "matchFileNames": [
        "apps/**/Dockerfile"
      ],
      "matchUpdateTypes": [
        "minor"
      ],
      "semanticCommitScope": "{{parentDir}}",
      "semanticCommitType": "feat"
    },
    {
      "addLabels": [
        "renovate/container",
        "type/patch"
      ],
      "additionalBranchPrefix": "{{parentDir}}-",
      "commitMessageExtra": "( {{currentVersion}} â†’ {{newVersion}} )",
      "commitMessageTopic": "{{depName}}",
      "labels": [
        "app/{{parentDir}}"
      ],
      "matchDatasources": [
        "docker",
        "github-release-attachments"
      ],
      "matchFileNames": [
        "apps/**/Dockerfile"
      ],
      "matchUpdateTypes": [
        "patch"
      ],
      "semanticCommitScope": "{{parentDir}}",
      "semanticCommitType": "fix"
    }
  ],
  customManagers: [
    {
      description: "Process annotated dependencies",
      customType: "regex",
      managerFilePatterns: [
        "^(?!.*\\.archive/).*Dockerfile$"
      ],
      matchStrings: [
        // # renovate: datasource=github-releases depName=k3s-io/k3s
        // k3s_release_version: &version v1.29.0+k3s1
        // # renovate: datasource=helm depName=cilium repository=https://helm.cilium.io
        // version: 1.15.1
        // # renovate: datasource=docker depName=ghcr.io/siderolabs/kubelet
        // KUBERNETES_VERSION=v1.31.1
        "datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)( repository=(?<registryUrl>\\S+))?\\n.+(:\\s|=)(&\\S+\\s)?(?<currentValue>\\S+)",
        // # renovate: datasource=docker depName=ghcr.io/prometheus-operator/prometheus-operator
        // https://raw.githubusercontent.com/prometheus-operator/prometheus-operator/v0.80.0/example/prometheus-operator-crd/monitoring.coreos.com_alertmanagerconfigs.yaml
        "datasource=(?<datasource>\\S+) depName=(?<depName>\\S+)\\n.+/(?<currentValue>(v|\\d)[^/]+)",
      ],
      datasourceTemplate: "{{#if datasource}}{{{datasource}}}{{else}}github-releases{{/if}}",
    },
  ]
}
